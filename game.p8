pico-8 cartridge // http://www.pico-8.com
version 34
__lua__

#include physics.p8
#include grappling_hook_physics.p8

function _init()
	-- init the player
	player =
		{
			x = 16,
			y = 112,
			w = 7,
			h = 7,
			dx = 0,
			dy = 0,
			has_momentum = false,
			is_jumping = false,
			is_on_ground = true,
			is_falling = false,
			is_solid = true,
			dir = "right",
			spr = 2,
			hook =
			{
				w=4,
				h=4,
				angle = 0,
				is_hooked = false,
				is_released = false,
				distance = 0,
				--max_distance = 32,
				max_distance = 0,
				timer = 0,
			},
			jump_speed = -3,
			gravity = 0.3,
		}

	player.hook.x = player.x + 2
	player.hook.y = player.y + 2
	player.hook.init_x = player.x + 2
	player.hook.init_y = player.y + 2

	cam = {}
	cam.x = 0
	cam.y = 0
end

function _update()
	player = grappling_hook_controls(player)
	player = update_grappling_hook(player)
	player = player_controls(player)
	player = move_actor(player)
	
	if(player.is_falling == false and player.is_on_ground == false and player.has_momentum and player.dy > 0) then
		player.is_falling = true
	end

	if(player.x - 64 < 0) then
		cam.x = 0
	else
		cam.x = player.x - 64
	end
	
	-- respawn after death
	if(player.y > 128) then
		player.x = 16
		player.y = 112
		player.has_momentum = false
		player.hook.distance = 0
		--player.hook.max_distance = 0
		player.hook.timer = 0
		player.hook.is_released = false
		player.hook.is_hooked = false
	end
end

function _draw()
	cls()

	camera(cam.x,cam.y)

	rectfill(cam.x,cam.y,cam.x+127,cam.y+63,12)

	palt(0,false)
	map()
	palt(0,true)

	if(player.hook.is_released) then
		line(player.hook.init_x+2,player.hook.init_y+2,player.hook.x+2,player.hook.y+2,8)
		spr(5,player.hook.x,player.hook.y)
	end

	if(player.dir == "right") then
		spr(player.spr,player.x,player.y)
	else
		spr(player.spr,player.x,player.y,1,1,true)
	end
	--[[
	print("x = " .. player.x, cam.x+0, 0, 8)
	print("y = " .. player.y, cam.x+0, 8, 8)
	print("dx = " .. player.dx, cam.x+0, 16, 8)
	print("dy = " .. player.dy, cam.x+0, 24, 8)
	print("hook distance = " .. player.hook.distance, cam.x+0, 32, 8)
	print("is_falling = " .. (player.is_falling and "true" or "false"), cam.x+0, 40, 8)
	]]
end
__gfx__
00000000000000000003330033333333333333330070000000003333333300000000000000000000000000000000000000000000000000000000000000000000
000000000666666000333330b33333b3bb3333330555000000033333333330000000000000000000000000000000000000000000000000000000000000000000
007007000666666003b3b3b05b3bb36b5db3bb3b75757000003333b3b33330000000000000000000000000000000000000000000000000000000000000000000
000770000666666003bbbbb06b3d5b56665b5db6055500000033bbbb3bbb33000000000000000000000000000000000000000000000000000000000000000000
00077000066666600033330066b566d6666566d6007000000033b33bbb33b3300000000000000000000000000000000000000000000000000000000000000000
00700700066666600b0330b0d5d5666dd5d5666d000000000033bb3bbbb3b3300000000000000000000000000000000000000000000000000000000000000000
0000000006666660000bb0006d6dd5566d6dd556000000000033bb3bbbb3b3300000000000000000000000000000000000000000000000000000000000000000
0000000000000000000bbb0065666d6665666d66000000000333bbbbbbbbb3300000000000000000000000000000000000000000000000000000000000000000
65666566c7c77cc7cccccccc00000000000000000000000000333333b33333000000000000000000000000000000000000000000000000000000000000000000
d66655667c7cc77c777777770000000000000000000000000030300b3b0303300000000000000000000000000000000000000000000000000000000000000000
5d56d665ccc77cc7c77cc7cc000000000000000000000000000000b333bbbb000000000000000000000000000000000000000000000000000000000000000000
665d5d567cccccc77c7c7ccc00000000000000000000000000000bb3330000000000000000000000000000000000000000000000000000000000000000000000
666566d6cc77cc7cccc7ccc700000000000000000000000000000bb3300000000000000000000000000000000000000000000000000000000000000000000000
d5d5666d7cccc7ccc77ccc7700000000000000000000000000000003300000000000000000000000000000000000000000000000000000000000000000000000
6d6dd556ccccccc7777777770000000000000000000000000000000bb00000000000000000000000000000000000000000000000000000000000000000000000
65666d66cc7c7ccccccccccc0000000000000000000000000000000bbb0000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000b00000300000ccccccc77ccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000b000000000003cccccc7744cccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000b003000000004cccc777444cccc7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000300000bc00044cc77774444cc74000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
030c000000003000044777474044c774000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000300000303004074777444000444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b03000300030030770747744404440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000c0300000303004404044040400444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b0303000c030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b0030030000300300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0030030b0003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c0030000000300300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00300000000b00030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000c000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0003000000300c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000003000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0003000303000000000000000000000003000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000001000000000001000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4243424342434243424342434243424342434243424342434243424310104243424342434243421042434243424310434243424342434243424342434243424342434243424342434243424342434243424342434243424342434243424342434243424342434243424342434243424342434243424342434243424342434243
0000000000101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6061606160616061606160616061606160616010101010616061606161616160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606061606160616061
6061606160616061606160616061606160616061606160616061606160606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606160616061606061606160616061
4041404140414041404140414041404140414041404140414041404140404140414041404140414041404140414041404140414041404140414041404140414041404140414041404140414041404140414041404140414041404140414041404140414041404140414041404140414041404140414041404041404140414041
5051505150515051505150515051505150515051505150515051505150505150515051505150515051505150515051505150515051505150515051505150515051505150515051505150515051505150515051505150515051505150515051505150515051505150515051505150515051505150515051505051505150515051
0000000000000000000000000003040300000003040304030400000003040000000304030400000000040304000000000403040000000000001212121212120000001212121212121212000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000310101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0304030403040304030403041010101011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
