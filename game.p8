pico-8 cartridge // http://www.pico-8.com
version 34
__lua__

#include physics.p8

function _init()
	-- init the player
	player = {
		x = 16,
		y = 112,
		w = 7,
		h = 7,
		dx = 0,
		dy = 0,
		is_jumping = false,
		is_on_ground = true,
		is_falling = false,
		is_solid = true,
		dir = "right",
		spr = 2,
		hook={
			is_hooked = false,
			is_released = false,
			distance = 0,
			timer = 0,
		},
	}
end

function _update()
	player = player_controls(player)
	player = move_actor(player)

	-- launch the grappling hook
	if(btnp(4) and not player.hook_is_released) then
		player.hook.is_released = true
	end

	if(player.hook.is_hooked == false and player.hook.is_released) then

		local hook = {x=player.x+4-2,y=player.y-player.hook.distance-4,w=4,h=4}

		if solid_area(hook.x,hook.y,hook.w,hook.h) then
			player.hook.is_hooked = true
		end

		if(player.hook.timer <= 15) then
			player.hook.distance += 2
		else
			player.hook.distance -= 2
		end

		if(player.hook.timer >= 30) then
			player.hook.is_released = false
			player.hook.timer = 0
		end

		player.hook.timer += 1
	end

	if(player.hook.is_hooked) then
		player.dx = 0
		player.dy = 0

		if(btnp(4)) then
			player.hook.distance = 0
			player.hook.timer = 0
			player.hook.is_released = false
			player.hook.is_hooked = false
		end
	end

	
end

function _draw()
	cls()
	map()

	if(player.hook.is_released) then

		line(player.x+4,player.y,player.x+4,player.y - player.hook.distance,7)
		spr(5,player.x+4-2,player.y-player.hook.distance-4)


		--local hook = {x=player.x+4-2,y=player.y-player.hook.distance-4,w=4,h=4}
		--rect(hook.x,hook.y,hook.x+hook.w,hook.y+hook.h,8)
	end

	if(player.dir == "right") then
		spr(player.spr,player.x,player.y)
	else
		spr(player.spr,player.x,player.y,1,1,true)
	end
end
__gfx__
000000000000000000033300bb0000bb000888000070000000003333333300000000000000000000000000000000000000000000000000000000000000000000
000000000666666000333330b066660b008888800555000000033333333330000000000000000000000000000000000000000000000000000000000000000000
007007000666666003b3b3b00666606008f1f1f075757000003333b3b33330000000000000000000000000000000000000000000000000000000000000000000
000770000666666003bbbbb00606666008fffff0055500000033bbbb3bbb33000000000000000000000000000000000000000000000000000000000000000000
0007700006666660003333000666666001111110007000000033b33bbb33b3300000000000000000000000000000000000000000000000000000000000000000
00700700066666600b0330b0066600600f1111f0000000000033bb3bbbb3b3300000000000000000000000000000000000000000000000000000000000000000
0000000006666660000bb0000666666000cccc00000000000033bb3bbbb3b3300000000000000000000000000000000000000000000000000000000000000000
0000000000000000000bbb00b000000b00c00c00000000000333bbbbbbbbb3300000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000333333b33333000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000030300b3b0303300000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000b333bbbb000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000bb3330000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000bb3300000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000003300000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000bb00000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000bbb0000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000010101000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
